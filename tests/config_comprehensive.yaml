# Comprehensive Test Configuration for gr-sleipnir
# Tests all operating modes and channel conditions

test_parameters:
  # Input file
  input_file: "wav/cq_pcm.wav"
  
  # Modulation modes to test
  modulation_modes: [4, 8]  # FSK levels (4FSK, 8FSK)
  
  # SNR sweep parameters: [start, stop, step]
  snr_range: [-5, 20, 1]  # -5 dB to +20 dB in 1 dB steps
  
  # FEC matrix files
  fec_matrices:
    auth: "ldpc_matrices/ldpc_auth_1536_512.alist"
    voice_4fsk: "ldpc_matrices/ldpc_voice_576_384.alist"  # Rate 2/3 for voice frames (works for 4FSK)
    voice_8fsk: "ldpc_matrices/ldpc_voice_576_384.alist"  # Rate 2/3 for voice frames (works for 8FSK)
  
  # Crypto modes to test
  crypto_modes: ["none", "sign", "encrypt", "both"]
  
  # Channel conditions
  channel_conditions:
    - name: "clean"
      type: "clean"
    - name: "awgn"
      type: "awgn"
    - name: "rayleigh"
      type: "fading"
      fading_type: "rayleigh"
      doppler_freq: 1.0
    - name: "rician"
      type: "fading"
      fading_type: "rician"
      k_factor: 3.0
      doppler_freq: 1.0
    - name: "freq_offset_100hz"
      type: "freq_offset"
      offset_hz: 100
    - name: "freq_offset_500hz"
      type: "freq_offset"
      offset_hz: 500
    - name: "freq_offset_1khz"
      type: "freq_offset"
      offset_hz: 1000
  
  # Data modes
  data_modes: ["voice", "voice_aprs", "voice_text", "aprs_only", "text_only", "mixed"]
  
  # Test duration per scenario (seconds)
  # Increased to allow time for superframe assembly (need 24-25 frames)
  test_duration: 10.0
  
  # Memory management options
  use_process_isolation: true  # Set to true to run tests in separate processes (prevents memory accumulation)
  process_batch_size: 50  # Number of tests per process when using process isolation
  
  # Audio sample rate (Hz)
  audio_samp_rate: 48000.0
  
  # RF sample rate (Hz)
  rf_samp_rate: 48000.0
  
  # Symbol rate (symbols/sec)
  symbol_rate: 4800.0
  
  # FSK deviation (Hz)
  fsk_deviation: 2400.0

output:
  # Results directory
  results_dir: "./test-results-files"
  
  # Audio output directory
  audio_output_dir: "./output-wav"
  
  # Plots directory
  plots_dir: "./test-results-files/plots"
  
  # Results JSON file
  results_json: "./test-results-json/results.json"
  
  # Report file
  report_file: "./test-results-files/report.md"

pass_criteria:
  # Frame Error Rate thresholds
  # Adjusted to match current hard-decision LDPC decoder performance
  # With soft-decision decoding, these could be lowered
  fer_threshold_10db: 0.05  # FER < 5% at 10 dB SNR (realistic for hard-decision decoding)
  fer_threshold_15db: 0.05  # FER < 5% at 15 dB SNR (realistic for hard-decision decoding)
  
  # Audio quality thresholds
  warpq_threshold: 2.5  # Minimum acceptable WarpQ score
  warpq_threshold_10db: 3.0  # WarpQ > 3.0 at 10 dB SNR
  
  # Crypto verification thresholds
  crypto_verification_rate: 1.0  # 100% verification when properly keyed
  crypto_rejection_rate: 1.0  # 100% rejection of invalid signatures
  
  # Sync performance thresholds
  sync_acquisition_time: 1.0  # < 1 second
  sync_recovery_time: 2.0  # < 2 seconds
  
  # Processing performance thresholds
  max_latency_ms: 500  # < 500ms end-to-end latency
  max_cpu_percent: 50  # < 50% CPU usage

test_phases:
  # Phase 1: Critical path (baseline tests)
  phase1:
    enabled: true
    modulation_modes: [4]
    crypto_modes: ["none"]
    channel_conditions: ["clean", "awgn"]
    snr_range: [-5, 20, 5]  # Coarser steps for phase 1
  
  # Phase 2: Full coverage
  phase2:
    enabled: true
    modulation_modes: [4, 8]
    crypto_modes: ["none", "sign", "encrypt", "both"]
    channel_conditions: ["clean", "awgn", "rayleigh", "rician"]
    snr_range: [-5, 20, 1]
  
  # Phase 3: Performance Analysis and Validation + Text Messaging + Recipient Addressing
  phase3:
    enabled: true
    # Phase 3 focuses on critical performance comparisons:
    # 1. 8FSK Performance (waterfall SNR, FER floor, audio quality)
    # 2. Crypto Overhead (NONE vs SIGN vs ENCRYPT vs BOTH)
    # 3. Fading Channel Robustness (Rayleigh/Rician penalties)
    # 4. Frequency Offset Tolerance
    # 5. Text Messaging (voice + text, text-only)
    # 6. Recipient Addressing (single recipient, multi-recipient)
    
    # Focused test scenarios for performance analysis
    modulation_modes: [4, 8]  # Compare 4FSK vs 8FSK
    crypto_modes: ["none", "sign", "encrypt", "both"]  # Measure crypto overhead
    channel_conditions: ["clean", "awgn", "rayleigh", "rician", "freq_offset_100hz", "freq_offset_500hz", "freq_offset_1khz"]
    snr_range: [-2, 20, 1]  # Fine-grained SNR sweep for waterfall detection
    
    # Data modes to test
    data_modes: ["voice", "voice_text"]  # Voice only, and voice + text messaging
    
    # Recipient addressing scenarios
    recipient_scenarios: ["single", "two", "multi"]  # Single recipient, two recipients, multi-recipient (3+ recipients)
    
    # Encryption recipient scenarios (for encrypted modes)
    # When encryption is enabled, test with multiple recipients to verify multi-recipient encryption
    encryption_recipient_tests: true  # Enable encryption tests with multiple recipients

logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "./test_results_comprehensive/test_run.log"
  console: true

hardware:
  # Key management
  test_key_path: "./test_keys"
  use_kernel_keyring: false
  use_nitrokey: false  # Set to true if Nitrokey hardware available
  
  # Skip hardware-dependent tests if hardware unavailable
  skip_if_unavailable: true
